<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clasificador de elementos patrimoniales</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 0; background: #f6f7fb; color: #111; }
    .wrap { max-width: 900px; margin: 0 auto; padding: 16px; }
    .card { background: white; border-radius: 14px; padding: 16px; box-shadow: 0 6px 20px rgba(0,0,0,.06); margin: 12px 0; }
    h1 { font-size: 20px; margin: 0 0 8px; }
    .row { display: grid; grid-template-columns: 1fr; gap: 10px; }
    label { font-weight: 600; font-size: 14px; }
    input, select, button { font-size: 16px; padding: 10px 12px; border-radius: 10px; border: 1px solid #d8dbe6; width: 100%; box-sizing: border-box; }
    button { border: 0; background: #2563eb; color: white; font-weight: 700; cursor: pointer; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    .muted { color: #555; font-size: 13px; }
    .pill { display: inline-block; padding: 4px 10px; border-radius: 999px; background: #eef2ff; color: #1e40af; font-weight: 700; font-size: 12px; }
    .gridQ { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 760px){ .gridQ { grid-template-columns: 1fr 1fr; } }
    .q { border: 1px solid #eef0f7; border-radius: 12px; padding: 12px; background: #fafbff; }
    .q h3 { margin: 0 0 8px; font-size: 15px; }
    .result { white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: #0b1220; color: #e5e7eb; padding: 12px; border-radius: 12px; }
  </style>
</head>

<body>
<div class="wrap">

  <div class="card">
    <h1>Clasificador de elementos patrimoniales</h1>
    <div class="muted">EBAU – Comunidad de Madrid</div>
    <div class="muted">Cada alumno obtiene una versión distinta automáticamente (sin códigos del profesor).</div>
  </div>

  <div class="card">
    <div class="row">
      <div>
        <label>Nombre y apellidos</label>
        <input id="alumno" placeholder="Ej: Laura García López" autocomplete="name">
        <div class="muted">Recomendación: escribir siempre igual (mismos apellidos/acentos) para mantener la misma versión.</div>
      </div>

      <div>
        <label>Número de elementos</label>
        <select id="num">
          <option value="10">10</option>
          <option value="15" selected>15</option>
          <option value="20">20</option>
          <option value="25">25</option>
          <option value="30">30</option>
          <option value="40">40</option>
          <option value="50">50</option>
        </select>
      </div>

      <div>
        <button id="btnStart">Empezar</button>
      </div>
    </div>
  </div>

  <div class="card" id="zonaPreguntas" style="display:none;">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
      <div class="pill" id="estado"></div>
      <div class="pill" id="version"></div>
      <button id="btnEnviar" disabled>Enviar</button>
    </div>
    <div style="height:10px"></div>
    <div class="gridQ" id="preguntas"></div>
  </div>

  <div class="card" id="zonaResultado" style="display:none;">
    <h2 style="margin:0 0 10px;">Resultado</h2>
    <div id="resumen"></div>
    <div style="height:10px"></div>
    <div class="result" id="detalle"></div>
  </div>

</div>

<script>
/* ================= BANCO DE ELEMENTOS (50 – EBAU MADRID) ================= */

const MASAS = [
  "Activo no corriente",
  "Activo corriente",
  "Patrimonio neto",
  "Pasivo no corriente",
  "Pasivo corriente"
];

const ELEMENTOS = {
  // ACTIVO NO CORRIENTE (14)
  "Terrenos y bienes naturales": "Activo no corriente",
  "Construcciones": "Activo no corriente",
  "Instalaciones técnicas": "Activo no corriente",
  "Maquinaria": "Activo no corriente",
  "Utillaje": "Activo no corriente",
  "Mobiliario": "Activo no corriente",
  "Equipos para procesos de información": "Activo no corriente",
  "Elementos de transporte": "Activo no corriente",
  "Inmovilizado en curso": "Activo no corriente",
  "Aplicaciones informáticas": "Activo no corriente",
  "Propiedad industrial": "Activo no corriente",
  "Patentes": "Activo no corriente",
  "Fondo de comercio": "Activo no corriente",
  "Inversiones financieras a largo plazo": "Activo no corriente",

  // ACTIVO CORRIENTE (16)
  "Mercaderías": "Activo corriente",
  "Materias primas": "Activo corriente",
  "Productos en curso": "Activo corriente",
  "Productos terminados": "Activo corriente",
  "Envases y embalajes": "Activo corriente",
  "Anticipos a proveedores": "Activo corriente",
  "Clientes": "Activo corriente",
  "Clientes, efectos comerciales a cobrar": "Activo corriente",
  "Deudores": "Activo corriente",
  "Deudores varios": "Activo corriente",
  "Hacienda Pública deudora": "Activo corriente",
  "Inversiones financieras a corto plazo": "Activo corriente",
  "Bancos": "Activo corriente",
  "Caja": "Activo corriente",
  "Efectos comerciales a cobrar": "Activo corriente",
  "Existencias": "Activo corriente",

  // PATRIMONIO NETO (8)
  "Capital social": "Patrimonio neto",
  "Capital pendiente de desembolso": "Patrimonio neto",
  "Prima de emisión": "Patrimonio neto",
  "Reservas legales": "Patrimonio neto",
  "Reservas voluntarias": "Patrimonio neto",
  "Resultado del ejercicio": "Patrimonio neto",
  "Resultados de ejercicios anteriores": "Patrimonio neto",
  "Subvenciones oficiales de capital": "Patrimonio neto",

  // PASIVO NO CORRIENTE (6)
  "Préstamos a largo plazo": "Pasivo no corriente",
  "Deudas a largo plazo con entidades de crédito": "Pasivo no corriente",
  "Proveedores de inmovilizado a largo plazo": "Pasivo no corriente",
  "Empréstitos": "Pasivo no corriente",
  "Provisiones a largo plazo": "Pasivo no corriente",
  "Pasivo por impuesto diferido": "Pasivo no corriente",

  // PASIVO CORRIENTE (6)
  "Proveedores": "Pasivo corriente",
  "Acreedores": "Pasivo corriente",
  "Deudas a corto plazo con entidades de crédito": "Pasivo corriente",
  "Hacienda Pública acreedora": "Pasivo corriente",
  "Organismos de la Seguridad Social acreedores": "Pasivo corriente",
  "Remuneraciones pendientes de pago": "Pasivo corriente"
};

/* ================= VERSIONES AUTOMÁTICAS (SIN PROFESOR) =================
   Semilla = hash(nombre_normalizado + "|" + device_id)
   - device_id se genera 1 vez y se guarda en el navegador (localStorage)
   - mismo alumno en el mismo dispositivo => misma versión
*/

function normalizarTexto(s){
  return (s || "")
    .trim()
    .toLowerCase()
    .normalize("NFD")                 // separa acentos
    .replace(/[\u0300-\u036f]/g, "")  // elimina diacríticos
    .replace(/\s+/g, " ");
}

// hash de texto a 32-bit (xmur3)
function xmur3(str) {
  let h = 1779033703 ^ str.length;
  for (let i = 0; i < str.length; i++) {
    h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
    h = (h << 13) | (h >>> 19);
  }
  return function() {
    h = Math.imul(h ^ (h >>> 16), 2246822507);
    h = Math.imul(h ^ (h >>> 13), 3266489909);
    h ^= (h >>> 16);
    return h >>> 0;
  }
}

// PRNG determinista (mulberry32)
function mulberry32(a) {
  return function() {
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  }
}

function shuffleWithRng(arr, rng){
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(rng() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function getDeviceId(){
  const key = "clasificador_device_id_v1";
  let id = localStorage.getItem(key);
  if (id) return id;

  // Genera un id aleatorio (UUID si existe)
  if (window.crypto && crypto.randomUUID) {
    id = crypto.randomUUID();
  } else {
    id = "dev-" + Math.random().toString(16).slice(2) + "-" + Date.now().toString(16);
  }

  localStorage.setItem(key, id);
  return id;
}

/* ================= LÓGICA DEL PROGRAMA ================= */

const NOTA_MAX = 10;
const PENAL = 0.5;

let seleccion = [];
let respuestas = {};
let versionId = "";

const $ = id => document.getElementById(id);

function renderPreguntas(){
  $("zonaPreguntas").style.display = "";
  $("zonaResultado").style.display = "none";
  $("preguntas").innerHTML = "";
  respuestas = {};
  $("estado").textContent = `Preguntas: ${seleccion.length}`;
  $("version").textContent = `Versión: ${versionId}`;

  seleccion.forEach(el => {
    const div = document.createElement("div");
    div.className = "q";
    div.innerHTML = `
      <h3>${el}</h3>
      <label>Selecciona la masa</label>
      <select>
        <option value="" selected>— Elige —</option>
        ${MASAS.map(m => `<option value="${m}">${m}</option>`).join("")}
      </select>
    `;
    const sel = div.querySelector("select");
    sel.addEventListener("change", () => {
      respuestas[el] = sel.value;
      const completas = seleccion.every(x => respuestas[x] && respuestas[x].trim().length > 0);
      $("btnEnviar").disabled = !completas;
    });
    $("preguntas").appendChild(div);
  });
}

function corregir(){
  let fallos = 0;
  const errores = [];

  seleccion.forEach(el => {
    const elegida = respuestas[el] || "";
    const correcta = ELEMENTOS[el];
    if (elegida !== correcta) {
      fallos++;
      errores.push({ elemento: el, tu_masa: elegida || "—", correcta });
    }
  });

  const aciertos = seleccion.length - fallos;
  let nota = NOTA_MAX - (fallos * PENAL);
  if (nota < 0) nota = 0;
  nota = Math.round(nota * 100) / 100;

  return { aciertos, fallos, nota, errores };
}

$("btnStart").addEventListener("click", () => {
  const alumno = $("alumno").value.trim();
  if (alumno.length < 3){
    alert("Escribe nombre y apellidos (mínimo 3 caracteres).");
    return;
  }

  const n = parseInt($("num").value, 10);

  const deviceId = getDeviceId();
  const seedText = normalizarTexto(alumno) + "|" + deviceId;

  const seedFn = xmur3(seedText);
  const seed = seedFn();

  versionId = "V-" + seed.toString(16).toUpperCase().padStart(8, "0");

  const rng = mulberry32(seed);
  const lista = shuffleWithRng(Object.keys(ELEMENTOS), rng);

  seleccion = lista.slice(0, Math.min(n, lista.length));
  renderPreguntas();
  $("btnEnviar").disabled = true;
});

$("btnEnviar").addEventListener("click", () => {
  const alumno = $("alumno").value.trim();
  const r = corregir();

  $("zonaResultado").style.display = "";
  $("resumen").innerHTML = `
    <div><b>Alumno:</b> ${alumno}</div>
    <div><b>${versionId}</b></div>
    <div><b>Aciertos:</b> ${r.aciertos}/${seleccion.length}</div>
    <div><b>Fallos:</b> ${r.fallos}</div>
    <div><b>Nota:</b> ${r.nota.toFixed(2)} / 10</div>
    <div class="muted">Penalización: -${PENAL} por fallo</div>
  `;

  const lines = [];
  if (r.errores.length === 0){
    lines.push("✅ Todo correcto.");
  } else {
    lines.push("❌ Errores:");
    r.errores.forEach(e => {
      lines.push(`- ${e.elemento}`);
      lines.push(`  Tu respuesta: ${e.tu_masa}`);
      lines.push(`  Correcta:     ${e.correcta}`);
      lines.push("");
    });
  }
  $("detalle").textContent = lines.join("\n");
});
</script>

</body>
</html>









